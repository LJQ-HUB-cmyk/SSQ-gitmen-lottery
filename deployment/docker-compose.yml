version: '3.8'

services:
  # 双色球容器
  lottery-ssq:
    build:
      context: ..
      dockerfile: deployment/docker/Dockerfile
      args:
        LOTTERY_TYPE: ssq
    container_name: lottery-ssq
    restart: unless-stopped
    environment:
      # 彩票类型
      LOTTERY_TYPE: ssq
      
      # 数据库配置
      MYSQL_HOST: ${MYSQL_HOST}
      MYSQL_PORT: ${MYSQL_PORT:-3306}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      
      # SSL 配置
      MYSQL_USE_SSL: ${MYSQL_USE_SSL:-false}
      MYSQL_SSL_CA: ${MYSQL_SSL_CA:-}
      
      # Telegram 配置
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID}
      
      # 爬虫配置
      SPIDER_TIMEOUT: ${SPIDER_TIMEOUT:-15}
      SPIDER_RETRY_TIMES: ${SPIDER_RETRY_TIMES:-3}
      SPIDER_MIN_DELAY: ${SPIDER_MIN_DELAY:-0.5}
      SPIDER_MAX_DELAY: ${SPIDER_MAX_DELAY:-2.0}
      
      # 数据库性能配置
      DB_BATCH_SIZE: ${DB_BATCH_SIZE:-100}
      
      # 日志配置
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      
      # 时区
      TZ: Asia/Shanghai
      
      # 定时任务时间（小时）
      CRON_HOUR: ${SSQ_CRON_HOUR:-22}
    
    volumes:
      - ../logs/ssq:/app/logs/ssq
      - ../data:/app/data
    
    networks:
      - lottery-network
    
    healthcheck:
      test: ["CMD", "python", "-c", "from core.base_database import BaseDatabase; from core.utils import load_db_config; db = BaseDatabase(load_db_config()); db.connect(); db.close()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # 大乐透容器
  lottery-dlt:
    build:
      context: ..
      dockerfile: deployment/docker/Dockerfile
      args:
        LOTTERY_TYPE: dlt
    container_name: lottery-dlt
    restart: unless-stopped
    environment:
      LOTTERY_TYPE: dlt
      MYSQL_HOST: ${MYSQL_HOST}
      MYSQL_PORT: ${MYSQL_PORT:-3306}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USE_SSL: ${MYSQL_USE_SSL:-false}
      MYSQL_SSL_CA: ${MYSQL_SSL_CA:-}
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID}
      SPIDER_TIMEOUT: ${SPIDER_TIMEOUT:-15}
      SPIDER_RETRY_TIMES: ${SPIDER_RETRY_TIMES:-3}
      SPIDER_MIN_DELAY: ${SPIDER_MIN_DELAY:-0.5}
      SPIDER_MAX_DELAY: ${SPIDER_MAX_DELAY:-2.0}
      DB_BATCH_SIZE: ${DB_BATCH_SIZE:-100}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      TZ: Asia/Shanghai
      CRON_HOUR: ${DLT_CRON_HOUR:-22}
    
    volumes:
      - ../logs/dlt:/app/logs/dlt
      - ../data:/app/data
    
    networks:
      - lottery-network
    
    healthcheck:
      test: ["CMD", "python", "-c", "from core.base_database import BaseDatabase; from core.utils import load_db_config; db = BaseDatabase(load_db_config()); db.connect(); db.close()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    
    # 大乐透功能未完成，暂时禁用
    profiles:
      - dlt

  # 快开3容器
  lottery-ks3:
    build:
      context: ..
      dockerfile: deployment/docker/Dockerfile
      args:
        LOTTERY_TYPE: ks3
    container_name: lottery-ks3
    restart: unless-stopped
    environment:
      LOTTERY_TYPE: ks3
      MYSQL_HOST: ${MYSQL_HOST}
      MYSQL_PORT: ${MYSQL_PORT:-3306}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USE_SSL: ${MYSQL_USE_SSL:-false}
      MYSQL_SSL_CA: ${MYSQL_SSL_CA:-}
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID}
      SPIDER_TIMEOUT: ${SPIDER_TIMEOUT:-15}
      SPIDER_RETRY_TIMES: ${SPIDER_RETRY_TIMES:-3}
      SPIDER_MIN_DELAY: ${SPIDER_MIN_DELAY:-0.5}
      SPIDER_MAX_DELAY: ${SPIDER_MAX_DELAY:-2.0}
      DB_BATCH_SIZE: ${DB_BATCH_SIZE:-100}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      TZ: Asia/Shanghai
      CRON_HOUR: ${KS3_CRON_HOUR:-22}
    
    volumes:
      - ../logs/ks3:/app/logs/ks3
      - ../data:/app/data
    
    networks:
      - lottery-network
    
    healthcheck:
      test: ["CMD", "python", "-c", "from core.base_database import BaseDatabase; from core.utils import load_db_config; db = BaseDatabase(load_db_config()); db.connect(); db.close()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    
    # 快开3功能未完成，暂时禁用
    profiles:
      - ks3

networks:
  lottery-network:
    driver: bridge
