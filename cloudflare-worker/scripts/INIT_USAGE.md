# init.sh ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

`init.sh` è„šæœ¬ç”¨äºæ‰¹é‡å¯¼å…¥å†å²æ•°æ®ï¼Œæ”¯æŒåŒè‰²çƒå’Œå¤§ä¹é€ã€‚

## æ›´æ–°å†…å®¹ âœ…

- âœ… æ”¯æŒåŒè‰²çƒï¼ˆssqï¼‰
- âœ… æ”¯æŒå¤§ä¹é€ï¼ˆdltï¼‰
- âœ… æ”¯æŒæ‰€æœ‰ç±»å‹ï¼ˆä¸å¸¦å‚æ•°ï¼‰
- âœ… é€šè¿‡å‚æ•°æŒ‡å®šå½©ç¥¨ç±»å‹
- âœ… è‡ªåŠ¨è°ƒç”¨å¯¹åº”çš„ API æ¥å£
- âœ… æ˜¾ç¤ºå½©ç¥¨ç±»å‹å’Œåç§°

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# åˆå§‹åŒ–æ‰€æœ‰ç±»å‹ï¼ˆæ¨èï¼‰
./scripts/init.sh

# åˆå§‹åŒ–æŒ‡å®šç±»å‹
./scripts/init.sh ssq    # ä»…åŒè‰²çƒ
./scripts/init.sh dlt    # ä»…å¤§ä¹é€
```

### é…ç½®æ–‡ä»¶

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```bash
# Worker URL
WORKER_URL=https://your-worker.workers.dev

# API Key
API_KEY=your-api-key

# çˆ¬å–é—´éš”ï¼ˆç§’ï¼‰
SLEEP_TIME=120

# æ¯æ—¥è¯·æ±‚é™åˆ¶
DAILY_REQUEST_LIMIT=500

# æ˜¯å¦è‡ªåŠ¨è·¨å¤©ç»§ç»­
AUTO_CONTINUE=false

# ä»£ç†é…ç½®ï¼ˆå¯é€‰ï¼‰
USE_PROXY=false
PROXY_PORT=7890
```

## åŠŸèƒ½ç‰¹æ€§

### 1. æ”¯æŒå¤šå½©ç¥¨ç±»å‹

```bash
# åŒè‰²çƒ
./scripts/init.sh ssq

# å¤§ä¹é€
./scripts/init.sh dlt
```

### 2. è‡ªåŠ¨æ–­ç‚¹ç»­ä¼ 

- è‡ªåŠ¨è·³è¿‡å·²å­˜åœ¨çš„æ•°æ®
- æ”¯æŒä¸­æ–­åç»§ç»­æ‰§è¡Œ
- è®°å½•æ¯æ—¥è¯·æ±‚æ¬¡æ•°

### 3. æ¯æ—¥è¯·æ±‚é™åˆ¶

- é»˜è®¤æ¯æ—¥é™åˆ¶ 500 æ¬¡
- è¾¾åˆ°é™åˆ¶åè‡ªåŠ¨åœæ­¢æˆ–ç­‰å¾…è·¨å¤©
- å¯é…ç½® `AUTO_CONTINUE=true` è‡ªåŠ¨è·¨å¤©ç»§ç»­

### 4. æ™ºèƒ½æç¤º

- æ˜¾ç¤ºå½“å‰è¿›åº¦
- æç¤ºæ•°æ®é‡æ¥è¿‘å®Œæˆ
- æ˜¾ç¤ºæ•°æ®æºå’ŒæŸ¥è¯¢å‚æ•°

## ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåˆå§‹åŒ–åŒè‰²çƒ

```bash
$ ./scripts/init.sh ssq

ğŸš€ åŒè‰²çƒæ•°æ®åˆå§‹åŒ–
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å½©ç¥¨ç±»å‹: ssq (åŒè‰²çƒ)
Worker URL: https://your-worker.workers.dev
æ¯æ—¥é™åˆ¶: 500 æ¬¡
çˆ¬å–é—´éš”: 120 ç§’
è‡ªåŠ¨è·¨å¤©: å¦

ğŸ“Š ä»Šæ—¥å·²æ‰§è¡Œ: 0/500 æ¬¡

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æ‰§è¡Œç¬¬ 1 æ¬¡...
æ—¶é—´: 2025-11-18 13:00:00

{
  "success": true,
  "message": "2025 å¹´æ•°æ®çˆ¬å–å®Œæˆ",
  "inserted": 131,
  "skipped": 0,
  "total": 3378,
  "year": 2025,
  "hasMore": false,
  "lotteryType": "ssq"
}

âœ… æœ¬æ‰¹æ¬¡æˆåŠŸ
   æ–°å¢: 131 æ¡
   è·³è¿‡: 0 æ¡
   å½“å‰æ€»è®¡: 3378 æ¡
   æ•°æ®æº: 500.com
   æŸ¥è¯¢å‚æ•°: start=25001, end=25200

âœ… æœ¬æ‰¹æ¬¡æ–°å¢ 131 æ¡æ•°æ®ï¼Œç»§ç»­çˆ¬å–...

â³ ç­‰å¾… 120 ç§’åç»§ç»­...
   æœ¬æ¬¡ä¼šè¯: ç¬¬ 1 æ¬¡ | ä»Šæ—¥æ€»è®¡: 1/500 æ¬¡
   ï¼ˆæŒ‰ Ctrl+C å¯éšæ—¶åœæ­¢ï¼‰
```

### ç¤ºä¾‹2ï¼šåˆå§‹åŒ–å¤§ä¹é€

```bash
$ ./scripts/init.sh dlt

ğŸš€ å¤§ä¹é€æ•°æ®åˆå§‹åŒ–
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å½©ç¥¨ç±»å‹: dlt (å¤§ä¹é€)
Worker URL: https://your-worker.workers.dev
æ¯æ—¥é™åˆ¶: 500 æ¬¡
çˆ¬å–é—´éš”: 120 ç§’
è‡ªåŠ¨è·¨å¤©: å¦

ğŸ“Š ä»Šæ—¥å·²æ‰§è¡Œ: 0/500 æ¬¡

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æ‰§è¡Œç¬¬ 1 æ¬¡...
æ—¶é—´: 2025-11-18 13:00:00

{
  "success": true,
  "message": "2025 å¹´æ•°æ®çˆ¬å–å®Œæˆ",
  "inserted": 131,
  "skipped": 0,
  "total": 2799,
  "year": 2025,
  "hasMore": false,
  "lotteryType": "dlt"
}

âœ… æœ¬æ‰¹æ¬¡æˆåŠŸ
   æ–°å¢: 131 æ¡
   è·³è¿‡: 0 æ¡
   å½“å‰æ€»è®¡: 2799 æ¡
   æ•°æ®æº: 500.com
   æŸ¥è¯¢å‚æ•°: start=25001, end=25200

ğŸ’¡ æç¤ºï¼šæ•°æ®åº“å·²æœ‰ 2799 æ¡æ•°æ®ï¼ˆå¤§ä¹é€ä»2007å¹´å¼€å§‹ï¼Œçº¦æœ‰2700+æœŸï¼‰
   å¦‚æœæ•°æ®é‡æ¥è¿‘å†å²æ€»æœŸæ•°ï¼Œå¯èƒ½å³å°†å®Œæˆ

âœ… æœ¬æ‰¹æ¬¡æ–°å¢ 131 æ¡æ•°æ®ï¼Œç»§ç»­çˆ¬å–...

â³ ç­‰å¾… 120 ç§’åç»§ç»­...
   æœ¬æ¬¡ä¼šè¯: ç¬¬ 1 æ¬¡ | ä»Šæ—¥æ€»è®¡: 1/500 æ¬¡
   ï¼ˆæŒ‰ Ctrl+C å¯éšæ—¶åœæ­¢ï¼‰
```

### ç¤ºä¾‹3ï¼šæ•°æ®çˆ¬å–å®Œæˆ

```bash
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ æ•°æ®çˆ¬å–å®Œæˆï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š æœ€ç»ˆç»Ÿè®¡ï¼š
   æ€»æ‰§è¡Œæ¬¡æ•°: 18 æ¬¡
   æ•°æ®åº“æ€»æ•°æ®é‡: 2799 æ¡

ğŸ“ˆ è¯¦ç»†ç»Ÿè®¡ï¼š
{
  "lottery_type": "dlt",
  "lottery_name": "å¤§ä¹é€",
  "total_count": 2799,
  "top_front_balls": [
    { "ball": "29", "count": 483 },
    { "ball": "35", "count": 466 }
  ],
  "top_back_balls": [
    { "ball": "10", "count": 503 },
    { "ball": "07", "count": 495 }
  ]
}

âœ… å¤§ä¹é€æ‰€æœ‰å†å²æ•°æ®å·²æˆåŠŸå¯¼å…¥ï¼
```

## å·¥ä½œæµç¨‹

1. **è¯»å–é…ç½®**
   - ä» `.env` æ–‡ä»¶è¯»å–é…ç½®
   - éªŒè¯ Worker URL å’Œ API Key

2. **éªŒè¯å½©ç¥¨ç±»å‹**
   - æ£€æŸ¥å‚æ•°æ˜¯å¦ä¸º `ssq` æˆ– `dlt`
   - è®¾ç½®å¯¹åº”çš„å½©ç¥¨åç§°

3. **å¾ªç¯çˆ¬å–**
   - è°ƒç”¨ `/init/{type}` API
   - æ¯æ¬¡çˆ¬å–ä¸€å¹´çš„æ•°æ®
   - è‡ªåŠ¨è·³è¿‡å·²å­˜åœ¨çš„æ•°æ®

4. **æ™ºèƒ½åœæ­¢**
   - è¿ç»­3æ¬¡æ— æ–°æ•°æ®æ—¶åœæ­¢
   - è¾¾åˆ°æ¯æ—¥é™åˆ¶æ—¶åœæ­¢
   - å¯é…ç½®è‡ªåŠ¨è·¨å¤©ç»§ç»­

5. **æ˜¾ç¤ºç»Ÿè®¡**
   - æ˜¾ç¤ºçˆ¬å–è¿›åº¦
   - æ˜¾ç¤ºæ•°æ®æºä¿¡æ¯
   - æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡

## é…ç½®è¯´æ˜

### SLEEP_TIMEï¼ˆçˆ¬å–é—´éš”ï¼‰

```bash
SLEEP_TIME=120  # æ¯æ¬¡çˆ¬å–é—´éš” 120 ç§’
```

**å»ºè®®å€¼**ï¼š
- å¿«é€Ÿæ¨¡å¼ï¼š60 ç§’
- æ­£å¸¸æ¨¡å¼ï¼š120 ç§’ï¼ˆæ¨èï¼‰
- ä¿å®ˆæ¨¡å¼ï¼š180 ç§’

### DAILY_REQUEST_LIMITï¼ˆæ¯æ—¥é™åˆ¶ï¼‰

```bash
DAILY_REQUEST_LIMIT=500  # æ¯æ—¥æœ€å¤š 500 æ¬¡
```

**è¯´æ˜**ï¼š
- åŒè‰²çƒï¼šçº¦ 18 å¹´æ•°æ®ï¼Œéœ€è¦ 18 æ¬¡
- å¤§ä¹é€ï¼šçº¦ 18 å¹´æ•°æ®ï¼Œéœ€è¦ 18 æ¬¡
- å»ºè®®è®¾ç½®ä¸º 500ï¼Œè¶³å¤Ÿå®Œæˆåˆå§‹åŒ–

### AUTO_CONTINUEï¼ˆè‡ªåŠ¨è·¨å¤©ï¼‰

```bash
AUTO_CONTINUE=false  # ä¸è‡ªåŠ¨è·¨å¤©
AUTO_CONTINUE=true   # è‡ªåŠ¨è·¨å¤©ç»§ç»­
```

**è¯´æ˜**ï¼š
- `false`ï¼šè¾¾åˆ°æ¯æ—¥é™åˆ¶ååœæ­¢ï¼Œéœ€è¦æ‰‹åŠ¨é‡æ–°è¿è¡Œ
- `true`ï¼šè¾¾åˆ°æ¯æ—¥é™åˆ¶åç­‰å¾…åˆ°ç¬¬äºŒå¤© 00:00 è‡ªåŠ¨ç»§ç»­

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šè®¤è¯å¤±è´¥

```
âŒ è®¤è¯å¤±è´¥ï¼è¯·æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ API_KEY æ˜¯å¦æ­£ç¡®
```

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat .env | grep API_KEY

# æ›´æ–° API_KEY
vim .env
```

### é—®é¢˜2ï¼šWorker URL æœªé…ç½®

```
âŒ é”™è¯¯ï¼šè¯·å…ˆé…ç½® WORKER_URL
```

**è§£å†³**ï¼š
```bash
# ç¼–è¾‘ .env æ–‡ä»¶
vim .env

# è®¾ç½® WORKER_URL
WORKER_URL=https://your-worker.workers.dev
```

### é—®é¢˜3ï¼šä¸æ”¯æŒçš„å½©ç¥¨ç±»å‹

```
âŒ é”™è¯¯ï¼šä¸æ”¯æŒçš„å½©ç¥¨ç±»å‹ 'xxx'
```

**è§£å†³**ï¼š
```bash
# ä½¿ç”¨æ­£ç¡®çš„å½©ç¥¨ç±»å‹
./scripts/init.sh ssq  # åŒè‰²çƒ
./scripts/init.sh dlt  # å¤§ä¹é€
```

### é—®é¢˜4ï¼šè¾¾åˆ°æ¯æ—¥é™åˆ¶

```
â¸ï¸  å·²è¾¾åˆ°ä»Šæ—¥è¯·æ±‚é™åˆ¶
```

**è§£å†³æ–¹æ¡ˆ1**ï¼šç­‰å¾…ç¬¬äºŒå¤©é‡æ–°è¿è¡Œ
```bash
# ç¬¬äºŒå¤©ç»§ç»­
./scripts/init.sh dlt
```

**è§£å†³æ–¹æ¡ˆ2**ï¼šå¯ç”¨è‡ªåŠ¨è·¨å¤©
```bash
# ç¼–è¾‘ .env
AUTO_CONTINUE=true

# é‡æ–°è¿è¡Œ
./scripts/init.sh dlt
```

**è§£å†³æ–¹æ¡ˆ3**ï¼šè°ƒæ•´æ¯æ—¥é™åˆ¶
```bash
# ç¼–è¾‘ .env
DAILY_REQUEST_LIMIT=1000

# é‡æ–°è¿è¡Œ
./scripts/init.sh dlt
```

## æœ€ä½³å®è·µ

### 1. é¦–æ¬¡åˆå§‹åŒ–

```bash
# 1. é…ç½® .env
cp .env.example .env
vim .env

# 2. åˆå§‹åŒ–åŒè‰²çƒ
./scripts/init.sh ssq

# 3. ç­‰å¾…å®Œæˆåï¼Œåˆå§‹åŒ–å¤§ä¹é€
./scripts/init.sh dlt
```

### 2. ä½¿ç”¨ screen æˆ– tmux

```bash
# ä½¿ç”¨ screenï¼ˆæ¨èï¼‰
screen -S lottery-init
./scripts/init.sh dlt
# æŒ‰ Ctrl+A, D åˆ†ç¦»ä¼šè¯

# é‡æ–°è¿æ¥
screen -r lottery-init

# æˆ–ä½¿ç”¨ tmux
tmux new -s lottery-init
./scripts/init.sh dlt
# æŒ‰ Ctrl+B, D åˆ†ç¦»ä¼šè¯

# é‡æ–°è¿æ¥
tmux attach -t lottery-init
```

### 3. åå°è¿è¡Œ

```bash
# ä½¿ç”¨ nohup
nohup ./scripts/init.sh dlt > init-dlt.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f init-dlt.log

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep init.sh
```

### 4. å®šæ—¶æ£€æŸ¥

```bash
# æŸ¥çœ‹ä»Šæ—¥æ‰§è¡Œæ¬¡æ•°
cat /tmp/lottery_init_count_$(date '+%Y-%m-%d').txt

# æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡
curl https://your-worker.workers.dev/stats/dlt | jq
```

## ç›¸å…³è„šæœ¬

- `init.sh` - æ‰¹é‡åˆå§‹åŒ–è„šæœ¬ï¼ˆæœ¬è„šæœ¬ï¼‰
- `test-incremental.sh` - æµ‹è¯•å¢é‡çˆ¬å–
- `diagnose.sh` - è¯Šæ–­å·¥å…·
- `set-strategies.sh` - è®¾ç½®é¢„æµ‹ç­–ç•¥

## ç›¸å…³æ–‡æ¡£

- [API ä½¿ç”¨æ–‡æ¡£](../API_USAGE.md)
- [Worker æ›´æ–°æŒ‡å—](../WORKER_DLT_UPDATE_GUIDE.md)
- [éƒ¨ç½²æŒ‡å—](../docs/DEPLOY.md)

---

**ç‰ˆæœ¬**ï¼š3.0.0  
**æ›´æ–°æ—¥æœŸ**ï¼š2025-11-18  
**è¯´æ˜**ï¼šæ”¯æŒå¤šå½©ç¥¨ç±»å‹ï¼Œä½¿ç”¨ç»Ÿä¸€çš„å¢é‡çˆ¬å–é€»è¾‘
